const searchParameter=document.getElementById("searchParameter"),searchValue=document.getElementById("searchValue"),buttonSearch=document.getElementById("search"),lista=document.getElementById("lista");let counter=0;const progressBar=document.querySelector(".progress-bar"),welcome=document.getElementById("welcome");progressBar.style.width="0%";const url="https://openlibrary.org";function createElement(e,t,r){counter++;const o=document.createElement(e);return o.className=t,o.id=`${r}${counter}`,o}function getBookTitle(e,t){let r=e.title;r=createElement("a","bookTitle col-lg-12","bookTitle"),r.setAttribute("href",`${url}/${e.key}`),r.setAttribute("target","_blank"),t.appendChild(r),r.innerHTML+=e.title}function getBookCover(e,t,r){let o=`https://covers.openlibrary.org/b/id/${"subject"===r?e.cover_id:e.cover_i}.jpg`;const a=createElement("img","bookCover img col-lg-8","bookCover");a.setAttribute("src",o),a.setAttribute("alt","testo alternativo"),t.appendChild(a)}function getAuthorName(e,t){let r=createElement("a","authorsPara col-lg-12","authors");_.get(e,"authors[0].name")?(authorsArray=e.authors[0].name,authorKey=e.authors[0].key,authorKeyLink=` ${url}/${authorKey}`):(authorsArray=e.author_name,authorKey=e.author_key,authorKeyLink=`${url}/authors/${authorKey}`),r.setAttribute("href",`${authorKeyLink}`),r.setAttribute("target","_blank"),t.printAuthorsName||(t.printAuthorsName=!0,r.innerHTML=authorsArray,t.appendChild(r))}function createToast(e){let t=createElement("div","toast error show","toast"),r=createElement("h2","headError","error");r.innerHTML=e,t.appendChild(r),lista.appendChild(t),progressBar.style.width="100%",progressBar.classList.add("bg-danger")}function getBooks(e,t){let r;if("subject"===t){if(-1!==(e=e.trim().toLowerCase()).indexOf(" "))return void createToast("La ricerca per categoria accetta una sola parola");r=`${url}/subjects/${e}.json?limit=50`}else"name"===t?r=`${url}/search.json?title=${e}&limit=50`:"author"===t&&(r=`${url}/search.json?author=${e}&limit=50`);axios.get(r,{onDownloadProgress:e=>{const t=Math.round(100*e.loaded/e.total);progressBar.style.width=`${t}%`}}).then((e=>{progressBar.style.width="100%",progressBar.classList.remove("bg-danger"),progressBar.classList.add("bg-success");const r="subject"===t?e.data.works:e.data.docs;_.isEmpty(r)&&createToast("La ricerca non ha prodotto nessun risultato"),_.forEach(r,(e=>{const r=createElement("li","col-lg-3 listElement","book"),o=createElement("button","descriptionButton btn btn-info  col-lg-12",`btnDescription${counter}`);o.innerHTML="Mostra descrizione",lista.appendChild(r),getBookTitle(e,r),getAuthorName(e,r),getBookCover(e,r,t),o.addEventListener("click",(()=>{toggleDescription(r,e)})),r.appendChild(o)}))})).catch((e=>{createToast(`Errore durante la ricerca del libro : ${e}`)}))}function getDescription(e,t){const r=e.key;axios.get(`${url}${r}.json`,{onDownloadProgress:e=>{const t=Math.round(100*e.loaded/e.total);progressBar.style.width=`${t}%`}}).then((e=>{progressBar.style.width="100%",progressBar.classList.remove("bg-danger"),progressBar.classList.add("bg-success");let r=e.data.description,o=createElement("p","col-12 descriptionPara","para");t.descriptionPara||(r?"object"==typeof r?(o.innerHTML=r.value,t.appendChild(o)):(o.innerHTML=r,t.appendChild(o)):(r="Nessuna descrizione disponibile.",o.innerHTML+=r,t.appendChild(o))),t.descriptionVisible=!0,t.descriptionPara=!0})).catch((e=>{createToast(`Errore durante la richiesta della descrizione: ${e}`)}))}function toggleDescription(e,t){const r=e.querySelector(".descriptionPara"),o=e.querySelector(".descriptionButton");e.descriptionVisible?(r&&(r.remove(),progressBar.style.width="0%",e.descriptionPara=!1,o.innerHTML=" Mostra descrizione"),e.descriptionVisible=!1):r||(getDescription(t,e),e.descriptionVisible=!0,o.innerHTML=" Nascondi descrizione")}buttonSearch.addEventListener("click",(e=>{e.preventDefault(),lista.innerHTML="",progressBar.style.width="0%",welcome.remove(),searchParameter.value.length>0&&searchValue.value.length>0?getBooks(searchValue.value,searchParameter.value):createToast("Controlla se hai compilato i campi correttamente!!!")}));