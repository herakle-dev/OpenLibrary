(()=>{const e=document.getElementById("searchParameter"),t=document.getElementById("searchValue"),r=document.getElementById("search"),o=document.getElementById("lista");let a=0;const i=document.querySelector(".progress-bar"),n=document.getElementById("welcome");i.style.width="0%";const s="https://openlibrary.org";function l(e,t,r){a++;const o=document.createElement(e);return o.className=t,o.id=`${r}${a}`,o}function c(e){let t=l("div","toast error show","toast"),r=l("h2","headError","error");r.innerHTML=e,t.appendChild(r),o.appendChild(t),i.style.width="100%",i.classList.add("bg-danger")}r.addEventListener("click",(r=>{r.preventDefault(),o.innerHTML="",i.style.width="0%",n.remove(),e.value.length>0&&t.value.length>0?function(e,t){let r;if("subject"===t){if(-1!==(e=e.trim().toLowerCase()).indexOf(" "))return void c("La ricerca per categoria accetta una sola parola");r=`${s}/subjects/${e}.json?limit=50`}else"name"===t?r=`${s}/search.json?title=${e}&limit=50`:"author"===t&&(r=`${s}/search.json?author=${e}&limit=50`);axios.get(r,{onDownloadProgress:e=>{const t=Math.round(100*e.loaded/e.total);i.style.width=`${t}%`}}).then((e=>{i.style.width="100%",i.classList.remove("bg-danger"),i.classList.add("bg-success");const r="subject"===t?e.data.works:e.data.docs;_.isEmpty(r)&&c("La ricerca non ha prodotto nessun risultato"),_.forEach(r,(e=>{const r=l("li","col-lg-3 listElement","book"),n=l("button","descriptionButton btn btn-info  col-lg-12",`btnDescription${a}`);n.innerHTML="Mostra descrizione",o.appendChild(r),function(e,t){let r=e.title;r=l("a","bookTitle col-lg-12","bookTitle"),r.setAttribute("href",`${s}/${e.key}`),r.setAttribute("target","_blank"),t.appendChild(r),r.innerHTML+=e.title}(e,r),function(e,t){let r=l("a","authorsPara col-lg-12","authors");_.get(e,"authors[0].name")?(authorsArray=e.authors[0].name,authorKey=e.authors[0].key,authorKeyLink=` ${s}/${authorKey}`):(authorsArray=e.author_name,authorKey=e.author_key,authorKeyLink=`${s}/authors/${authorKey}`),r.setAttribute("href",`${authorKeyLink}`),r.setAttribute("target","_blank"),t.printAuthorsName||(t.printAuthorsName=!0,r.innerHTML=authorsArray,t.appendChild(r))}(e,r),function(e,t,r){let o=`https://covers.openlibrary.org/b/id/${"subject"===r?e.cover_id:e.cover_i}.jpg`;const a=l("img","bookCover img col-lg-8","bookCover");a.setAttribute("src",o),a.setAttribute("alt","testo alternativo"),t.appendChild(a)}(e,r,t),n.addEventListener("click",(()=>{!function(e,t){const r=e.querySelector(".descriptionPara"),o=e.querySelector(".descriptionButton");e.descriptionVisible?(r&&(r.remove(),i.style.width="0%",e.descriptionPara=!1,o.innerHTML=" Mostra descrizione"),e.descriptionVisible=!1):r||(function(e,t){const r=e.key;axios.get(`${s}${r}.json`,{onDownloadProgress:e=>{const t=Math.round(100*e.loaded/e.total);i.style.width=`${t}%`}}).then((e=>{i.style.width="100%",i.classList.remove("bg-danger"),i.classList.add("bg-success");let r=e.data.description,o=l("p","col-12 descriptionPara","para");t.descriptionPara||(r?"object"==typeof r?(o.innerHTML=r.value,t.appendChild(o)):(o.innerHTML=r,t.appendChild(o)):(r="Nessuna descrizione disponibile.",o.innerHTML+=r,t.appendChild(o))),t.descriptionVisible=!0,t.descriptionPara=!0})).catch((e=>{c(`Errore durante la richiesta della descrizione: ${e}`)}))}(t,e),e.descriptionVisible=!0,o.innerHTML=" Nascondi descrizione")}(r,e)})),r.appendChild(n)}))})).catch((e=>{c(`Errore durante la ricerca del libro : ${e}`)}))}(t.value,e.value):c("Controlla se hai compilato i campi correttamente!!!")}))})();